name: ðŸ§ª LaboratÃ³rio de ExercÃ­cios
on: [push, pull_request]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: ðŸ› ï¸ Preparar RelatÃ³rio
        run: |
          echo "## ðŸ“Š RelatÃ³rio de CorreÃ§Ã£o AutomÃ¡tica" >> $GITHUB_STEP_SUMMARY
          echo "Gerado em: $(date +'%d/%m/%Y %H:%M:%S')" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| ExercÃ­cio | Status | CompilaÃ§Ã£o | Teste de Input |" >> $GITHUB_STEP_SUMMARY
          echo "| :--- | :---: | :---: | :---: |" >> $GITHUB_STEP_SUMMARY

      - name: âš™ï¸ Compilar e Testar
        run: |
          # Busca pastas que tenham arquivos .cpp
          for dir in $(find exercicios -maxdepth 1 -type d -not -path 'exercicios'); do
            NAME=$(basename "$dir")
            COMPILE_STATUS="âŒ"
            TEST_STATUS="âž–"
            ICON="ðŸ”´"
            
            # Tenta compilar
            if g++ -std=c++20 "$dir"/*.cpp -o "$dir/main" 2>/dev/null; then
              COMPILE_STATUS="âœ…"
              
              # Verifica se existe input.txt e roda o teste
              if [ -f "$dir/input.txt" ]; then
                if ./"$dir/main" < "$dir/input.txt" > /dev/null; then
                  TEST_STATUS="âœ… Passou"
                  ICON="ðŸŸ¢"
                else
                  TEST_STATUS="âŒ Falhou (Runtime)"
                fi
              else
                TEST_STATUS="âš ï¸ Sem input.txt"
              fi
            fi
            
            # Escreve a linha na tabela do relatÃ³rio
            echo "| $NAME | $ICON | $COMPILE_STATUS | $TEST_STATUS |" >> $GITHUB_STEP_SUMMARY
          done
